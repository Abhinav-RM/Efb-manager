<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
<title>EFB Tournament Manager</title>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700;800&family=Orbitron:wght@400;700;900&family=Exo+2:wght@400;700;900&family=Bebas+Neue&family=Audiowide&family=Michroma&family=Kanit:wght@700;900&family=Russo+One&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<!--
  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
  ‚ïë  FIX ‚Äî OFFLINE EXPORT (Issue 1)                                     ‚ïë
  ‚ïë  The CDN script below requires internet. For offline Android use,   ‚ïë
  ‚ïë  replace this <script src="..."> tag with an INLINE script:         ‚ïë
  ‚ïë                                                                      ‚ïë
  ‚ïë  1. Download html2canvas from:                                      ‚ïë
  ‚ïë     https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/       ‚ïë
  ‚ïë     html2canvas.min.js                                              ‚ïë
  ‚ïë  2. Copy the entire file contents                                   ‚ïë
  ‚ïë  3. Replace this comment block AND the script tag below with:       ‚ïë
  ‚ïë     <script>/* paste html2canvas source here */</script>            ‚ïë
  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{--ac:#00f3ff;--a2:#bc13fe;--ag:rgba(0,243,255,.2);--a2g:rgba(188,19,254,.18);--bg:#04040a;--border:rgba(255,255,255,.07);--text:#dde2f0;--muted:#444c6a;--fw:'Rajdhani',sans-serif;--sw:270px;--rad:6px;}
body.th-fire{--ac:#ff5500;--a2:#ff0033;--ag:rgba(255,85,0,.24);--a2g:rgba(255,0,51,.2);}
body.th-royal{--ac:#ffc400;--a2:#ff8800;--ag:rgba(255,196,0,.24);--a2g:rgba(255,136,0,.2);}
body.th-ice{--ac:#7dd3fc;--a2:#3b82f6;--ag:rgba(125,211,252,.22);--a2g:rgba(59,130,246,.2);}
body.th-matrix{--ac:#00ff41;--a2:#00bb33;--ag:rgba(0,255,65,.18);--a2g:rgba(0,187,51,.15);}
body.th-sunset{--ac:#f77f00;--a2:#d62828;--ag:rgba(247,127,0,.24);--a2g:rgba(214,40,40,.2);}
body.th-pink{--ac:#ff0099;--a2:#ff66cc;--ag:rgba(255,0,153,.24);--a2g:rgba(255,102,204,.2);}
body.th-violet{--ac:#9b5de5;--a2:#f15bb5;--ag:rgba(155,93,229,.24);--a2g:rgba(241,91,181,.2);}
body.th-amber{--ac:#ffbe0b;--a2:#fb5607;--ag:rgba(255,190,11,.24);--a2g:rgba(251,86,7,.2);}
body.th-teal{--ac:#14b8a6;--a2:#06b6d4;--ag:rgba(20,184,166,.22);--a2g:rgba(6,182,212,.2);}
body.th-crimson{--ac:#e63946;--a2:#ff9f1c;--ag:rgba(230,57,70,.24);--a2g:rgba(255,159,28,.2);}
body.fn-orbitron{--fw:'Orbitron',sans-serif;}body.fn-exo{--fw:'Exo 2',sans-serif;}
body.fn-bebas{--fw:'Bebas Neue',cursive;}body.fn-mono{--fw:'JetBrains Mono',monospace;}
body.fn-audiowide{--fw:'Audiowide',sans-serif;}body.fn-michroma{--fw:'Michroma',sans-serif;}
body.fn-kanit{--fw:'Kanit',sans-serif;}body.fn-russo{--fw:'Russo One',sans-serif;}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent;}
:focus,:focus-visible{outline:none!important;box-shadow:none!important;}
button{cursor:pointer;}
body{background-color:var(--bg);background-image:linear-gradient(rgba(255,255,255,.022) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.022) 1px,transparent 1px);background-size:44px 44px;color:var(--text);font-family:var(--fw);min-height:100vh;overflow-x:hidden;}

/* LOADING */
#ld{position:fixed;inset:0;z-index:9999;background:radial-gradient(ellipse at 50% 40%,#0d0d22,#000 70%);display:flex;flex-direction:column;align-items:center;justify-content:center;gap:18px;overflow:hidden;transition:opacity .9s,transform .9s cubic-bezier(.4,0,.2,1);}
#ld.out{opacity:0;transform:scale(1.06);pointer-events:none;}
.ld-mesh{position:absolute;inset:0;pointer-events:none;background:repeating-linear-gradient(0deg,transparent,transparent 34px,rgba(0,243,255,.018) 34px,rgba(0,243,255,.018) 35px),repeating-linear-gradient(90deg,transparent,transparent 34px,rgba(0,243,255,.018) 34px,rgba(0,243,255,.018) 35px);animation:meshS 20s linear infinite;}
@keyframes meshS{to{background-position:35px 35px;}}
.ld-pts{position:absolute;inset:0;overflow:hidden;pointer-events:none;}
.ld-pt{position:absolute;border-radius:50%;background:radial-gradient(circle,var(--ac),transparent 70%);opacity:0;animation:ptUp var(--d,4s) ease-in-out var(--dl,0s) infinite;}
@keyframes ptUp{0%{transform:translateY(105vh) scale(0);opacity:0;}8%{opacity:.9;transform:translateY(88vh) scale(1);}92%{opacity:.15;}100%{transform:translateY(-8vh) translateX(var(--dx,0px)) scale(.2);opacity:0;}}
.ld-logo{position:relative;width:120px;height:120px;animation:logoF 3s ease-in-out infinite alternate;}
@keyframes logoF{from{transform:translateY(-8px);}to{transform:translateY(8px);}}
.ld-ring{position:absolute;border-radius:50%;border:2px solid transparent;animation:spinR linear infinite;}
.ld-ring:nth-child(1){inset:0;border-top-color:var(--ac);animation-duration:1.2s;filter:drop-shadow(0 0 10px var(--ac));}
.ld-ring:nth-child(2){inset:14px;border-right-color:var(--a2);animation-duration:2s;animation-direction:reverse;}
.ld-ring:nth-child(3){inset:28px;border-bottom-color:var(--ac);animation-duration:2.8s;}
.ld-ring:nth-child(4){inset:42px;border-left-color:var(--a2);animation-duration:1.7s;animation-direction:reverse;}
.ld-ball{position:absolute;inset:42px;display:flex;align-items:center;justify-content:center;font-size:30px;animation:bPls 1.8s ease-in-out infinite alternate;}
@keyframes spinR{to{transform:rotate(360deg);}}@keyframes bPls{from{transform:scale(.9);}to{transform:scale(1.12);}}
.ld-ey{font-family:'Orbitron',sans-serif;font-size:10px;letter-spacing:7px;color:var(--ac);text-transform:uppercase;text-shadow:0 0 20px var(--ac);animation:epls 2s ease-in-out infinite;}
@keyframes epls{50%{text-shadow:0 0 40px var(--ac),0 0 70px var(--ag);}}
.ld-tw{max-width:min(88vw,540px);overflow:hidden;display:flex;justify-content:center;}
.ld-title{font-family:'Orbitron',sans-serif;font-size:clamp(13px,3.6vw,28px);font-weight:900;color:#fff;letter-spacing:3px;white-space:nowrap;text-shadow:0 0 30px rgba(0,243,255,.5);border-right:3px solid var(--ac);width:0;overflow:hidden;max-width:100%;animation:typit 1.8s steps(22,end) .5s forwards,blinkC .75s step-end .5s infinite;}
@keyframes typit{to{width:100%;}}@keyframes blinkC{50%{border-color:transparent;}}
.ld-bw{width:min(380px,76vw);height:3px;background:rgba(255,255,255,.06);border-radius:99px;overflow:hidden;}
.ld-b{height:100%;width:0;background:linear-gradient(90deg,var(--ac),var(--a2));border-radius:99px;box-shadow:0 0 16px var(--ac);animation:ldBar 3.2s cubic-bezier(.1,0,.2,1) forwards;}
@keyframes ldBar{0%{width:0}15%{width:10%}45%{width:50%}70%{width:75%}90%{width:92%}100%{width:100%}}
.ld-st{font-size:11px;letter-spacing:5px;color:var(--muted);text-transform:uppercase;height:16px;text-align:center;animation:fuup .8s ease both;}
@keyframes fuup{from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:none;}}

/* TOP BUTTONS */
.top-btn{position:fixed;top:14px;z-index:400;width:46px;height:46px;background:rgba(4,4,10,.94);border:1px solid var(--border);border-radius:12px;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(20px);user-select:none;transition:border-color .25s,background .25s,transform .2s;}
.top-btn:hover{border-color:var(--ac);background:rgba(0,243,255,.06);}
.top-btn:active{transform:scale(0.9);}
#hBtn{left:14px;flex-direction:column;gap:5px;}
#hBtn span{display:block;width:21px;height:2px;background:var(--text);border-radius:2px;transition:transform .32s cubic-bezier(.4,0,.2,1),opacity .3s,background .25s;}
#hBtn.open span:nth-child(1){transform:translateY(7px) rotate(45deg);background:var(--ac);}
#hBtn.open span:nth-child(2){opacity:0;transform:scaleX(0);}
#hBtn.open span:nth-child(3){transform:translateY(-7px) rotate(-45deg);background:var(--ac);}
#sBtn{right:14px;font-size:19px;transition:border-color .25s,transform .4s;}
#sBtn:hover{transform:rotate(65deg);}
#qBtn{position:fixed;top:68px;right:14px;z-index:400;width:46px;height:46px;border-radius:12px;background:rgba(4,4,10,.94);border:1px solid rgba(0,243,255,.25);display:flex;align-items:center;justify-content:center;font-family:'Orbitron',sans-serif;font-size:14px;font-weight:900;color:var(--ac);cursor:pointer;backdrop-filter:blur(20px);user-select:none;transition:all .25s;}
#qBtn:hover{background:rgba(0,243,255,.1);border-color:var(--ac);transform:scale(1.06);}
#qBtn.on{background:rgba(0,243,255,.15);box-shadow:0 0 18px var(--ag);}
#qPanel{position:fixed;top:68px;right:68px;z-index:401;background:rgba(4,4,12,.97);border:1px solid var(--ac);border-radius:14px;padding:16px;min-width:220px;backdrop-filter:blur(28px);display:none;flex-direction:column;gap:10px;box-shadow:0 0 40px rgba(0,243,255,.12);}
#qPanel.show{display:flex;}
.qp-t{font-size:9px;letter-spacing:4px;color:var(--muted);text-transform:uppercase;}
.qp-row{display:flex;gap:6px;flex-wrap:wrap;}
.qp-n{width:40px;height:36px;border-radius:8px;cursor:pointer;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--text);font-family:var(--fw);font-size:14px;font-weight:700;transition:all .2s;}
.qp-n:hover{border-color:var(--ac);color:var(--ac);}
.qp-n.on{border-color:var(--ac);color:var(--ac);background:rgba(0,243,255,.08);}
.qp-apply{width:100%;padding:9px;border-radius:8px;border:1px solid var(--ac);background:rgba(0,243,255,.1);color:var(--ac);font-family:var(--fw);font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;cursor:pointer;transition:all .2s;}
.qp-apply:hover{background:rgba(0,243,255,.22);}
.qp-rm{width:100%;padding:8px;border-radius:8px;border:1px solid rgba(255,50,50,.2);background:rgba(255,50,50,.06);color:#ff5555;font-family:var(--fw);font-size:11px;font-weight:800;letter-spacing:2px;text-transform:uppercase;cursor:pointer;transition:all .2s;}
.qp-rm:hover{background:rgba(255,50,50,.18);}

/* SIDEBAR OVERLAY */
.sbo{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(4px);z-index:350;opacity:0;pointer-events:none;transition:opacity .3s;}
.sbo.on{opacity:1;pointer-events:all;}

/* SIDEBAR */
#sb{position:fixed;top:0;left:0;width:var(--sw);height:100vh;background:rgba(3,3,8,.98);backdrop-filter:blur(30px);border-right:1px solid var(--border);z-index:380;transform:translateX(-110%);transition:transform .38s cubic-bezier(.4,0,.2,1);display:flex;flex-direction:column;overflow-y:auto;}
#sb.open{transform:translateX(0);}
.sb-h{padding:74px 20px 18px;border-bottom:1px solid var(--border);}
.sb-ey{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:5px;color:var(--ac);text-shadow:0 0 18px var(--ac);margin-bottom:4px;}
.sb-nm{font-size:20px;font-weight:800;color:#fff;letter-spacing:1px;line-height:1.2;}
.sb-vr{font-size:10px;color:var(--muted);letter-spacing:3px;margin-top:3px;}
.sb-sec{padding:8px 20px 3px;font-size:9px;letter-spacing:4px;color:var(--muted);text-transform:uppercase;margin-top:6px;}
.ni{display:flex;align-items:center;gap:13px;padding:12px 20px;cursor:pointer;font-size:13px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:rgba(255,255,255,.5);border-left:3px solid transparent;transition:all .2s;position:relative;}
.ni:hover{background:rgba(255,255,255,.04);color:rgba(255,255,255,.9);}
.ni.active{color:var(--ac);border-left-color:var(--ac);background:rgba(0,243,255,.05);}
.ni.active::after{content:'';position:absolute;right:0;top:50%;transform:translateY(-50%);width:4px;height:26px;border-radius:4px 0 0 4px;background:var(--ac);}
.ni-ic{font-size:17px;width:24px;text-align:center;flex-shrink:0;}

/* SETTINGS */
#sp{position:fixed;top:0;right:0;width:310px;height:100vh;background:rgba(3,3,8,.98);backdrop-filter:blur(30px);border-left:1px solid var(--border);z-index:380;transform:translateX(110%);transition:transform .38s cubic-bezier(.4,0,.2,1);padding:72px 16px 30px;overflow-y:auto;display:flex;flex-direction:column;gap:16px;}
#sp.open{transform:translateX(0);}
.sg-blk{background:rgba(255,255,255,.02);border:1px solid var(--border);border-radius:10px;padding:14px;}
.sg-t{font-size:9px;letter-spacing:4px;color:var(--muted);text-transform:uppercase;margin-bottom:12px;}
.sg-r{display:flex;flex-direction:column;gap:4px;margin-bottom:9px;}
.sg-l{font-size:10px;letter-spacing:2px;color:var(--muted);text-transform:uppercase;}
.sg-i{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:9px 12px;font-family:var(--fw);font-size:14px;width:100%;transition:border-color .22s,background .22s;-webkit-appearance:none;appearance:none;}
.sg-i:focus{border-color:var(--ac);background:rgba(0,243,255,.04);}
select.sg-i option{background:#0a0a18;}
.tg{display:grid;grid-template-columns:1fr 1fr;gap:7px;}
.tc{padding:8px 4px;border-radius:8px;cursor:pointer;border:1.5px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02);font-family:var(--fw);font-size:11px;font-weight:700;color:rgba(255,255,255,.5);text-align:center;transition:all .22s;white-space:nowrap;}
.tc:hover{transform:translateY(-2px);color:#fff;border-color:rgba(255,255,255,.2);}
.tc.on{border-color:var(--ac);color:var(--ac);background:rgba(0,243,255,.06);}
.fl{display:flex;flex-direction:column;gap:5px;}
.fc{padding:8px 11px;border-radius:7px;cursor:pointer;border:1px solid rgba(255,255,255,.06);background:rgba(255,255,255,.02);font-size:13px;color:rgba(255,255,255,.55);text-align:left;transition:all .2s;}
.fc:hover{background:rgba(255,255,255,.07);color:#fff;}
.fc.on{border-color:var(--ac);color:var(--ac);background:rgba(0,243,255,.04);}
.sa{width:100%;padding:11px 12px;border-radius:9px;border:1px solid var(--border);background:rgba(0,243,255,.07);color:var(--ac);display:block;font-family:var(--fw);font-size:12px;font-weight:700;letter-spacing:2px;cursor:pointer;transition:all .2s;text-transform:uppercase;margin-bottom:7px;}
.sa:hover{background:rgba(0,243,255,.15);border-color:var(--ac);}
.sa.red{background:rgba(255,50,50,.07);color:#ff5555;border-color:rgba(255,50,50,.15);}
.sa.red:hover{background:rgba(255,50,50,.18);border-color:#ff5555;}

/* PAGES */
.pg{display:none;min-height:100vh;padding:68px 14px 150px;}
.pg.active{display:block;}
.pg-h{text-align:center;margin-bottom:22px;padding-top:6px;}
.pg-h h1{font-family:'Orbitron',sans-serif;font-size:clamp(13px,2.8vw,22px);letter-spacing:5px;color:var(--ac);text-shadow:0 0 28px var(--ag);}
.pg-h p{font-size:10px;letter-spacing:4px;color:var(--muted);margin-top:5px;}

/* CAPTURE */
.cw{width:100%;overflow-x:auto;padding-bottom:14px;}
.ca{width:1400px;min-height:920px;margin:0 auto;position:relative;background:#06060e;overflow:hidden;border:1px solid rgba(255,255,255,.04);box-shadow:0 0 100px rgba(0,0,0,.95);}
.ubg{position:absolute;inset:0;background-size:cover;background-position:center;transform-origin:center;z-index:0;}
.ovl{position:absolute;inset:0;background:linear-gradient(165deg,rgba(0,0,0,.38),rgba(0,0,0,.82));z-index:1;}
.cl{position:relative;z-index:2;padding:65px;box-sizing:border-box;display:flex;flex-direction:column;}
.mh{font-family:'Orbitron',sans-serif;font-size:clamp(28px,4vw,54px);text-transform:uppercase;font-weight:900;text-align:center;letter-spacing:9px;margin-bottom:52px;color:#fff;text-shadow:0 0 30px var(--ag);border-bottom:2px solid var(--ac);padding-bottom:22px;display:inline-block;align-self:center;cursor:text;min-width:160px;}
.mh:focus{text-shadow:0 0 55px var(--ac),0 0 100px var(--ag);}

/* GRID & CARDS */
.gl{display:grid;grid-template-columns:1fr 1fr;gap:42px;width:100%;}
.gc{background:rgba(10,10,20,.75);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.07);border-radius:var(--rad);overflow:hidden;position:relative;}
.gc::before{content:'';position:absolute;top:0;left:0;width:100%;height:2px;background:linear-gradient(90deg,var(--ac),transparent);}
.gct{font-size:20px;font-weight:800;padding:14px 22px;color:var(--ac);text-transform:uppercase;letter-spacing:3px;border-bottom:1px solid var(--border);background:rgba(0,243,255,.04);display:flex;align-items:center;gap:10px;}
.gci{font-size:15px;opacity:.45;flex-shrink:0;user-select:none;}
.gcn{flex:1;cursor:text;}
.gcn:focus{color:var(--a2)!important;}

/* TABLES */
table{width:100%;border-collapse:collapse;font-family:'JetBrains Mono',monospace;}
th{font-family:var(--fw);font-size:11px;color:var(--muted);font-weight:700;padding:10px 6px;text-align:center;border-bottom:1px solid var(--border);text-transform:uppercase;letter-spacing:2px;}
th.tl{text-align:left;padding-left:18px;}
td{padding:10px 6px;border-bottom:1px solid rgba(255,255,255,.025);font-size:16px;text-align:center;}
td.tl{text-align:left;padding-left:18px;}
td.rk{color:var(--muted);font-size:12px;}
td.pts{color:var(--ac);font-weight:800;font-size:17px;text-shadow:0 0 10px var(--ag);}
td.tnm{color:#fff;font-weight:700;text-transform:uppercase;letter-spacing:1px;}
tr:last-child td{border-bottom:none;}
tr:hover td{background:rgba(0,243,255,.024);}
[contenteditable]{cursor:text;}
[contenteditable]:focus{color:var(--a2)!important;text-shadow:0 0 12px var(--a2g)!important;}
[contenteditable]:empty::before{content:attr(data-ph);color:rgba(255,255,255,.13);font-style:italic;font-weight:400;}
input.si{background:transparent;border:none;border-bottom:1px solid transparent;color:inherit;width:38px;text-align:center;font-family:'JetBrains Mono',monospace;font-size:16px;padding:2px 0;transition:color .18s,border-color .18s;border-radius:0;}
input.si:focus{color:var(--a2)!important;border-bottom-color:var(--a2);text-shadow:0 0 10px var(--a2g);}
input.si::-webkit-inner-spin-button,input.si::-webkit-outer-spin-button{-webkit-appearance:none;}

/* FIXTURES */
.fr{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;padding:14px 22px;border-bottom:1px solid rgba(255,255,255,.03);gap:10px;position:relative;}
.fr:last-child{border-bottom:none;}
.fr:hover{background:rgba(0,243,255,.024);}
.frb{position:absolute;left:0;top:0;bottom:0;width:3px;background:rgba(0,243,255,.18);}
.fr:nth-child(even) .frb{background:rgba(188,19,254,.22);}
.frt{font-family:'JetBrains Mono',monospace;font-size:17px;font-weight:700;text-transform:uppercase;color:#fff;cursor:text;white-space:nowrap;overflow:hidden;}
.frt.h{text-align:right;}
.fvw{display:flex;align-items:center;justify-content:center;}
.fvp{background:rgba(0,243,255,.07);border:1px solid rgba(0,243,255,.2);border-radius:5px;padding:4px 12px;font-size:13px;font-weight:800;letter-spacing:4px;color:var(--ac);white-space:nowrap;}
.fr:nth-child(even) .fvp{background:rgba(188,19,254,.07);border-color:rgba(188,19,254,.25);color:var(--a2);}
.fm{grid-column:1/-1;text-align:center;font-size:10px;letter-spacing:4px;color:var(--muted);text-transform:uppercase;cursor:text;margin-top:-2px;}
.fm:focus{color:var(--ac)!important;}

/* KNOCKOUT */
.bks{overflow-x:auto;padding:8px 0 18px;}
.bkf{display:flex;align-items:flex-start;gap:0;min-width:max-content;padding:10px 16px;}
.bkc{display:flex;flex-direction:column;align-items:center;min-width:210px;}
.bkch{display:flex;align-items:center;gap:8px;margin-bottom:14px;}
.bkrl{font-family:'Orbitron',sans-serif;font-size:9px;letter-spacing:4px;color:var(--ac);text-transform:uppercase;}
.bkrd{width:22px;height:22px;border-radius:50%;cursor:pointer;background:rgba(255,50,50,.08);border:1px solid rgba(255,50,50,.18);color:#ff5555;font-size:11px;display:flex;align-items:center;justify-content:center;transition:background .2s;flex-shrink:0;}
.bkrd:hover{background:rgba(255,50,50,.22);}
.bkms{display:flex;flex-direction:column;align-items:center;}
.bkm{width:200px;position:relative;background:rgba(8,8,18,.9);border:1px solid rgba(255,255,255,.07);border-radius:8px;overflow:hidden;transition:box-shadow .22s;}
.bkm::before{content:'';position:absolute;top:0;left:0;width:100%;height:2px;background:linear-gradient(90deg,var(--ac),transparent);}
.bkm:hover{box-shadow:0 0 25px rgba(0,243,255,.08);}
.bkm.gone{display:none!important;}
.bkdel{position:absolute;top:5px;right:5px;z-index:10;width:20px;height:20px;border-radius:50%;background:rgba(255,50,50,.1);border:1px solid rgba(255,50,50,.2);color:rgba(255,80,80,.7);font-size:10px;cursor:pointer;display:flex;align-items:center;justify-content:center;opacity:0;transition:all .2s;}
.bkm:hover .bkdel{opacity:1;}
.bkdel:hover{background:rgba(255,50,50,.28);color:#ff5555;transform:scale(1.18);}
.bks2{padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.04);font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:#fff;min-height:40px;cursor:grab;user-select:none;display:flex;align-items:center;gap:7px;transition:background .15s;}
.bks2:last-child{border-bottom:none;}
.bks2:hover{background:rgba(0,243,255,.06);}
.bks2.drag{opacity:.35;}
.bks2.over{background:rgba(0,243,255,.18);outline:1px dashed var(--ac);}
.bksn{font-size:9px;color:var(--muted);flex-shrink:0;width:13px;}
.bksname{flex:1;cursor:text;}
.bksname:focus{color:var(--a2)!important;}
.bksc{width:28px;padding:2px 3px;background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.1);border-radius:4px;color:var(--ac);font-size:12px;font-weight:800;text-align:center;font-family:'JetBrains Mono',monospace;flex-shrink:0;transition:border-color .2s;}
.bksc:focus{border-color:var(--ac);}
.bksc::-webkit-inner-spin-button{-webkit-appearance:none;}
.bkcon{width:36px;display:flex;align-items:center;justify-content:center;position:relative;flex-shrink:0;align-self:stretch;}
.bkcon::after{content:'';position:absolute;top:50%;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,var(--ac),transparent);opacity:.35;}
.bkcon span{position:relative;z-index:1;font-size:12px;color:var(--ac);opacity:.4;background:var(--bg);padding:0 3px;}
.wcol{min-width:220px;}
.wbox{width:200px;background:rgba(0,243,255,.04);border:2px solid var(--ac);border-radius:14px;padding:26px 18px;text-align:center;box-shadow:0 0 60px rgba(0,243,255,.1);}
.wtr{font-size:48px;display:block;margin-bottom:10px;animation:trglow 2.2s ease-in-out infinite alternate;}
@keyframes trglow{from{filter:drop-shadow(0 0 8px var(--ac));}to{filter:drop-shadow(0 0 28px var(--ac)) drop-shadow(0 0 50px var(--ag));}}
.wlbl{font-size:9px;letter-spacing:4px;color:var(--muted);margin-bottom:8px;}
.wnm{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:900;color:var(--ac);text-shadow:0 0 25px var(--ac);display:inline-block;min-width:50px;cursor:text;}

/* CONTROLS BAR */
.pctrl{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:rgba(3,3,8,.97);backdrop-filter:blur(24px);padding:10px 16px;border-radius:50px;border:1px solid var(--border);display:flex;gap:8px;z-index:200;box-shadow:0 16px 60px rgba(0,0,0,.95);max-width:95vw;justify-content:center;align-items:center;flex-wrap:wrap;}
.btn{background:linear-gradient(135deg,var(--ac) 0%,#0066ee 100%);color:#000;border:none;padding:9px 16px;border-radius:30px;font-family:var(--fw);font-weight:800;font-size:12px;text-transform:uppercase;letter-spacing:1px;box-shadow:0 0 14px rgba(0,243,255,.18);transition:box-shadow .22s,transform .15s,filter .15s;white-space:nowrap;user-select:none;}
.btn:hover{box-shadow:0 0 30px rgba(0,243,255,.45);filter:brightness(1.1);}
.btn:active{transform:scale(0.91);}
.btn.s{background:rgba(18,18,30,.98);color:var(--text);box-shadow:none;border:1px solid rgba(255,255,255,.1);}
.btn.s:hover{border-color:var(--ac);color:var(--ac);filter:none;}
.btn.sv{background:linear-gradient(135deg,#00cc55,#007733);color:#fff;}
.btn.sv:hover{box-shadow:0 0 22px rgba(0,200,80,.38);}
.btn.sort{background:linear-gradient(135deg,#ff8800,#cc5500);color:#fff;}
.btn.sort:hover{box-shadow:0 0 22px rgba(255,136,0,.38);}
.zc{display:flex;flex-direction:column;align-items:center;gap:1px;}
.zc label{font-size:8px;letter-spacing:3px;color:var(--muted);}
.zc input[type=range]{width:72px;accent-color:var(--ac);cursor:pointer;}

/* DASHBOARD */
.sr{display:grid;grid-template-columns:repeat(auto-fit,minmax(128px,1fr));gap:12px;margin-bottom:20px;}
.sc{background:rgba(8,8,18,.95);border:1px solid var(--border);border-radius:12px;padding:20px 14px;text-align:center;position:relative;overflow:hidden;transition:box-shadow .25s,transform .25s;}
.sc::before{content:'';position:absolute;top:0;left:0;width:100%;height:2px;background:linear-gradient(90deg,var(--ac),var(--a2));}
.sc:hover{box-shadow:0 8px 30px rgba(0,0,0,.5);transform:translateY(-2px);}
.sn{font-family:'Orbitron',sans-serif;font-size:36px;font-weight:900;color:var(--ac);text-shadow:0 0 22px var(--ag);line-height:1;}
.sl{font-size:9px;letter-spacing:3px;color:var(--muted);margin-top:5px;text-transform:uppercase;}
.dg2{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-bottom:16px;}
.dc{background:rgba(8,8,18,.95);border:1px solid var(--border);border-radius:12px;padding:20px;}
.dc:hover{box-shadow:0 6px 24px rgba(0,0,0,.4);}
.dct{font-size:9px;letter-spacing:4px;color:var(--muted);margin-bottom:14px;text-transform:uppercase;}
.ir{display:flex;justify-content:space-between;font-size:13px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.04);}
.ir:last-child{border-bottom:none;}
.ir span:first-child{color:var(--muted);}
.ir span:last-child{color:var(--ac);font-weight:700;}
.qnv{display:flex;flex-direction:column;gap:9px;}

/* NOTES */
.nta{width:100%;min-height:200px;background:rgba(8,8,18,.95);border:1px solid var(--border);border-radius:12px;padding:16px;color:var(--text);font-family:var(--fw);font-size:14px;resize:vertical;margin-bottom:16px;transition:border-color .22s;}
.nta:focus{border-color:var(--ac);}
.scc{background:rgba(8,8,18,.95);border:1px solid var(--border);border-radius:12px;padding:20px;}
.scc h2{font-size:9px;letter-spacing:4px;color:var(--muted);margin-bottom:14px;text-transform:uppercase;}
.scr{display:grid;grid-template-columns:2fr 1fr 1fr 1fr auto;gap:7px;margin-bottom:7px;align-items:center;}
.sci{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:7px;color:var(--text);padding:8px 10px;font-family:var(--fw);font-size:13px;width:100%;transition:border-color .2s;}
.sci:focus{border-color:var(--ac);}
.dbt{width:33px;height:33px;border-radius:7px;border:1px solid rgba(255,50,50,.18);background:rgba(255,50,50,.07);color:#ff5555;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:background .2s;}
.dbt:hover{background:rgba(255,50,50,.22);}

/* DRAW GROUPS MODAL */
#dgModal{position:fixed;inset:0;z-index:900;background:rgba(0,0,0,.88);backdrop-filter:blur(8px);display:none;align-items:flex-start;justify-content:center;overflow-y:auto;padding:20px 14px 100px;}
#dgModal.open{display:flex;}
.dg-panel{width:100%;max-width:700px;background:rgba(5,5,16,.99);border:1px solid var(--ac);border-radius:18px;overflow:hidden;box-shadow:0 0 80px rgba(0,243,255,.15);animation:panIn .35s cubic-bezier(.4,0,.2,1);}
@keyframes panIn{from{opacity:0;transform:translateY(24px);}to{opacity:1;transform:none;}}
.dg-hd{padding:22px 24px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;background:rgba(0,243,255,.04);}
.dg-hd-t{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:900;color:var(--ac);letter-spacing:4px;}
.dg-hd-x{width:34px;height:34px;border-radius:8px;border:1px solid rgba(255,50,50,.2);background:rgba(255,50,50,.07);color:#ff5555;font-size:16px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;}
.dg-hd-x:hover{background:rgba(255,50,50,.2);}
.dg-body{padding:22px 24px;display:flex;flex-direction:column;gap:20px;}
.dg-st{font-size:9px;letter-spacing:4px;color:var(--muted);text-transform:uppercase;margin-bottom:10px;}
.dg-cnt-row{display:flex;gap:12px;}
.dg-cnt-btn{flex:1;padding:14px 8px;border-radius:10px;cursor:pointer;border:2px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);font-family:'Orbitron',sans-serif;font-size:22px;font-weight:900;color:rgba(255,255,255,.5);text-align:center;transition:all .25s;line-height:1.3;}
.dg-cnt-btn:hover{border-color:rgba(255,255,255,.2);color:#fff;}
.dg-cnt-btn.on{border-color:var(--ac);color:var(--ac);background:rgba(0,243,255,.07);box-shadow:0 0 20px var(--ag);}
.dg-fmt-row{display:flex;gap:10px;flex-wrap:wrap;}
.dg-fmt-btn{padding:10px 14px;border-radius:9px;cursor:pointer;border:1px solid rgba(255,255,255,.08);background:rgba(255,255,255,.03);font-family:var(--fw);font-size:13px;font-weight:700;color:rgba(255,255,255,.5);transition:all .22s;}
.dg-fmt-btn:hover{border-color:rgba(255,255,255,.2);color:#fff;}
.dg-fmt-btn.on{border-color:var(--ac);color:var(--ac);background:rgba(0,243,255,.07);}
.dg-info{padding:12px 16px;border-radius:10px;background:rgba(0,243,255,.05);border:1px solid rgba(0,243,255,.15);font-size:13px;color:var(--ac);letter-spacing:2px;text-align:center;font-weight:700;}
.dg-tgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(155px,1fr));gap:8px;max-height:260px;overflow-y:auto;padding:2px;}
.dg-tin{background:rgba(255,255,255,.04);border:1px solid var(--border);border-radius:8px;color:var(--text);padding:9px 12px;font-family:var(--fw);font-size:13px;width:100%;transition:border-color .2s;}
.dg-tin:focus{border-color:var(--ac);background:rgba(0,243,255,.04);}
.dg-tin::placeholder{color:var(--muted);}
.dg-acts{display:flex;gap:10px;flex-wrap:wrap;}
.dg-prev-t{font-size:9px;letter-spacing:4px;color:var(--muted);text-transform:uppercase;margin-bottom:12px;}
.dg-ggrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:10px;}
.dg-grp{background:rgba(10,10,24,.8);border:1px solid rgba(255,255,255,.07);border-radius:8px;overflow:hidden;}
.dg-grp::before{content:'';display:block;height:2px;background:linear-gradient(90deg,var(--ac),transparent);}
.dg-grp-hd{padding:8px 12px;color:var(--ac);font-size:11px;font-weight:800;letter-spacing:3px;border-bottom:1px solid rgba(255,255,255,.05);}
.dg-grp-t{padding:7px 12px;font-size:12px;color:var(--text);border-bottom:1px solid rgba(255,255,255,.03);}
.dg-grp-t:last-child{border-bottom:none;}

/* MATCH COUNT BUTTON */
#mcBtn{position:fixed;top:68px;left:14px;z-index:400;width:46px;height:46px;border-radius:12px;background:rgba(4,4,10,.94);border:1px solid rgba(0,243,255,.25);display:flex;align-items:center;justify-content:center;font-family:'Orbitron',sans-serif;font-size:13px;font-weight:900;color:var(--ac);cursor:pointer;backdrop-filter:blur(20px);user-select:none;transition:all .25s;flex-direction:column;gap:2px;line-height:1;}
#mcBtn:hover{background:rgba(0,243,255,.1);border-color:var(--ac);transform:scale(1.06);}
#mcBtn.on{background:rgba(0,243,255,.15);box-shadow:0 0 18px var(--ag);}
#mcBtn .mc-lbl{font-size:7px;letter-spacing:1px;color:var(--muted);}
#mcPanel{position:fixed;top:68px;left:68px;z-index:401;background:rgba(4,4,12,.97);border:1px solid var(--ac);border-radius:14px;padding:14px;min-width:160px;backdrop-filter:blur(28px);display:none;flex-direction:column;gap:10px;box-shadow:0 0 40px rgba(0,243,255,.12);}
#mcPanel.show{display:flex;}
.mcp-t{font-size:9px;letter-spacing:4px;color:var(--muted);text-transform:uppercase;}
.mcp-row{display:flex;gap:6px;}
.mcp-n{width:44px;height:36px;border-radius:8px;cursor:pointer;border:1px solid var(--border);background:rgba(255,255,255,.03);color:var(--text);font-family:var(--fw);font-size:14px;font-weight:700;transition:all .2s;}
.mcp-n:hover{border-color:var(--ac);color:var(--ac);}
.mcp-n.on{border-color:var(--ac);color:var(--ac);background:rgba(0,243,255,.08);}

/* TOAST */
#toast{position:fixed;bottom:86px;left:50%;transform:translateX(-50%) translateY(10px);background:rgba(0,180,90,.12);border:1px solid rgba(0,200,100,.25);border-radius:30px;padding:6px 20px;font-size:11px;letter-spacing:3px;color:#00cc66;z-index:600;opacity:0;pointer-events:none;white-space:nowrap;transition:opacity .3s,transform .3s;}
#toast.on{opacity:1;transform:translateX(-50%) translateY(0);}
#toast.err{background:rgba(200,0,0,.12);border-color:rgba(255,50,50,.25);color:#ff5555;}

.rr{display:flex;align-items:center;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
@media(max-width:680px){:root{--sw:84vw;}.pg{padding:68px 9px 150px;}.pctrl{padding:9px 10px;gap:6px;}.btn{padding:7px 9px;font-size:11px;}.dg2{grid-template-columns:1fr;}.scr{grid-template-columns:1fr 1fr;}#sp{width:min(95vw,310px);}#qPanel{right:14px;top:122px;}}
@media(max-width:400px){.sr{grid-template-columns:1fr 1fr;}}
</style>
</head>
<body>

<div id="ld">
  <div class="ld-mesh"></div>
  <div class="ld-pts" id="ldP"></div>
  <div class="ld-ey">EFB TOURNAMENT SYSTEM</div>
  <div class="ld-logo">
    <div class="ld-ring"></div><div class="ld-ring"></div>
    <div class="ld-ring"></div><div class="ld-ring"></div>
    <div class="ld-ball">‚öΩ</div>
  </div>
  <div class="ld-tw"><div class="ld-title">EFB CUP MANAGER</div></div>
  <div class="ld-bw"><div class="ld-b"></div></div>
  <div class="ld-st" id="ldSt">LOADING...</div>
</div>

<div class="sbo" id="sbo" onclick="closeSB()"></div>
<div class="top-btn" id="hBtn" onclick="togSB()"><span></span><span></span><span></span></div>
<div class="top-btn" id="sBtn" onclick="togSP()">‚öôÔ∏è</div>
<div id="qBtn" onclick="togQ()" title="Qualify Teams">Q</div>
<div id="qPanel">
  <div class="qp-t">TOP N QUALIFIED PER GROUP</div>
  <div class="qp-row" id="qNRow"></div>
  <button class="qp-apply" onclick="applyQ()">‚úì MARK QUALIFIED</button>
  <button class="qp-rm" onclick="removeQ()">‚úï REMOVE ALL Q</button>
</div>

<div id="mcBtn" onclick="togMC()" title="Matches per Group"><span id="mcBtnVal">2</span><span class="mc-lbl">MATCHES</span></div>
<div id="mcPanel">
  <div class="mcp-t">MATCHES PER GROUP</div>
  <div class="mcp-row" id="mcNRow"></div>
</div>

<nav id="sb">
  <div class="sb-h">
    <div class="sb-ey">EFB TOURNAMENT SYSTEM</div>
    <div class="sb-nm" id="sbNm">EFB CUP MANAGER</div>
    <div class="sb-vr">V3.0 ¬∑ SEASON EDITION</div>
  </div>
  <div class="sb-sec">PAGES</div>
  <div class="ni active" data-page="dash"  onclick="go('dash')"><span class="ni-ic">üìä</span>Dashboard</div>
  <div class="ni" data-page="draw"         onclick="go('draw')"><span class="ni-ic">üéØ</span>Group Draw</div>
  <div class="ni" data-page="fix"          onclick="go('fix')"><span class="ni-ic">‚öΩ</span>Group Fixtures</div>
  <div class="ni" data-page="pts"          onclick="go('pts')"><span class="ni-ic">üìã</span>Points Table</div>
  <div class="ni" data-page="ko"           onclick="go('ko')"><span class="ni-ic">üèÜ</span>Knockout Stage</div>
  <div class="ni" data-page="notes"        onclick="go('notes')"><span class="ni-ic">üìù</span>Notes &amp; Schedule</div>
  <div class="sb-sec">TOOLS</div>
  <div class="ni" onclick="openDG()"><span class="ni-ic">üé≤</span>Draw Groups</div>
  <div class="sb-sec">ACTIONS</div>
  <div class="ni" onclick="saveAll()"><span class="ni-ic">üíæ</span>Save Progress</div>
  <div class="ni" onclick="expCur()"><span class="ni-ic">‚¨áÔ∏è</span>Export Image</div>
  <div class="ni" onclick="clrAll()"><span class="ni-ic">üóëÔ∏è</span>Clear All Data</div>
</nav>

<div id="sp">
  <div class="sg-blk">
    <div class="sg-t">‚öô Tournament Setup</div>
    <div class="sg-r"><span class="sg-l">Tournament Name</span><input type="text" class="sg-i" id="sgN" placeholder="EFB CUP SEASON 3" oninput="updNm(this.value)"></div>
    <div class="sg-r"><span class="sg-l">Groups</span>
      <select class="sg-i" id="sgG" onchange="applyS()"><option value="2">2 Groups</option><option value="4" selected>4 Groups</option><option value="6">6 Groups</option><option value="8">8 Groups</option></select></div>
    <div class="sg-r"><span class="sg-l">Teams Per Group</span>
      <select class="sg-i" id="sgT" onchange="applyS()"><option value="3">3 Teams</option><option value="4" selected>4 Teams</option><option value="5">5 Teams</option><option value="6">6 Teams</option><option value="8">8 Teams</option></select></div>
    <div class="sg-r"><span class="sg-l">Matches Per Group</span>
      <select class="sg-i" id="sgM" onchange="applyS()"><option value="2" selected>2 Matches</option><option value="3">3 Matches</option><option value="4">4 Matches</option><option value="6">6 Matches</option></select></div>
    <div class="sg-r"><span class="sg-l">Knockout Format</span>
      <select class="sg-i" id="sgK" onchange="applyS()"><option value="4">Semi Finals (4)</option><option value="8" selected>Quarter Finals (8)</option><option value="16">Round of 16 (16)</option></select></div>
  </div>
  <div class="sg-blk">
    <div class="sg-t">üé® Theme</div>
    <div class="tg">
      <button class="tc on" id="tc-cyber"   onclick="setTh('cyber')">üîµ CYBER</button>
      <button class="tc"    id="tc-fire"    onclick="setTh('fire')">üî¥ FIRE</button>
      <button class="tc"    id="tc-royal"   onclick="setTh('royal')">üü° ROYAL</button>
      <button class="tc"    id="tc-ice"     onclick="setTh('ice')">ü©µ ICE</button>
      <button class="tc"    id="tc-matrix"  onclick="setTh('matrix')">üü¢ MATRIX</button>
      <button class="tc"    id="tc-sunset"  onclick="setTh('sunset')">üü† SUNSET</button>
      <button class="tc"    id="tc-pink"    onclick="setTh('pink')">ü©∑ PINK</button>
      <button class="tc"    id="tc-violet"  onclick="setTh('violet')">üíú VIOLET</button>
      <button class="tc"    id="tc-amber"   onclick="setTh('amber')">üü§ AMBER</button>
      <button class="tc"    id="tc-teal"    onclick="setTh('teal')">üü¶ TEAL</button>
      <button class="tc"    id="tc-crimson" onclick="setTh('crimson')">‚ù§Ô∏è CRIMSON</button>
    </div>
  </div>
  <div class="sg-blk">
    <div class="sg-t">üî§ Font</div>
    <div class="fl">
      <button class="fc on" id="fc-default"   style="font-family:'Rajdhani'"      onclick="setFnt('default')">Rajdhani ‚Äî AaBb 123</button>
      <button class="fc"    id="fc-orbitron"  style="font-family:'Orbitron'"      onclick="setFnt('orbitron')">Orbitron ‚Äî ABCD 123</button>
      <button class="fc"    id="fc-audiowide" style="font-family:'Audiowide'"     onclick="setFnt('audiowide')">Audiowide ‚Äî AaBb 123</button>
      <button class="fc"    id="fc-michroma"  style="font-family:'Michroma'"      onclick="setFnt('michroma')">Michroma ‚Äî AaBb 123</button>
      <button class="fc"    id="fc-exo"       style="font-family:'Exo 2'"         onclick="setFnt('exo')">Exo 2 ‚Äî AaBb 123</button>
      <button class="fc"    id="fc-kanit"     style="font-family:'Kanit'"         onclick="setFnt('kanit')">Kanit ‚Äî AaBb 123</button>
      <button class="fc"    id="fc-russo"     style="font-family:'Russo One'"     onclick="setFnt('russo')">Russo One ‚Äî AaBb 123</button>
      <button class="fc"    id="fc-bebas"     style="font-family:'Bebas Neue'"    onclick="setFnt('bebas')">BEBAS NEUE</button>
      <button class="fc"    id="fc-mono"      style="font-family:'JetBrains Mono'"onclick="setFnt('mono')">JetBrains Mono</button>
    </div>
  </div>
  <div class="sg-blk">
    <div class="sg-t">üíæ Data</div>
    <button class="sa" onclick="saveAll()">üíæ Save All Progress</button>
    <button class="sa" onclick="expCur()">‚¨á Export Current Page</button>
    <button class="sa" onclick="rstKO()">üîÑ Restore KO Boxes</button>
    <button class="sa" onclick="openDG()">üé≤ Draw Groups</button>
    <button class="sa red" onclick="clrAll()">üóë Clear All Data</button>
  </div>
</div>

<div id="toast"></div>

<!-- DRAW GROUPS MODAL -->
<div id="dgModal">
  <div class="dg-panel">
    <div class="dg-hd">
      <div class="dg-hd-t">üé≤ DRAW GROUPS</div>
      <button class="dg-hd-x" onclick="closeDG()">‚úï</button>
    </div>
    <div class="dg-body">
      <div>
        <div class="dg-st">1 ‚Äî TOTAL TEAMS</div>
        <div class="dg-cnt-row">
          <button class="dg-cnt-btn on" id="dgB20" onclick="setDGC(20)">20<br><small style="font-size:11px;opacity:.6">TEAMS</small></button>
          <button class="dg-cnt-btn"    id="dgB24" onclick="setDGC(24)">24<br><small style="font-size:11px;opacity:.6">TEAMS</small></button>
        </div>
      </div>
      <div>
        <div class="dg-st">2 ‚Äî GROUP FORMAT</div>
        <div class="dg-fmt-row" id="dgFR"></div>
        <div class="dg-info" id="dgInfo">4 GROUPS √ó 5 TEAMS</div>
      </div>
      <div>
        <div class="dg-st">3 ‚Äî ENTER TEAM NAMES</div>
        <div class="dg-tgrid" id="dgTG"></div>
      </div>
      <div class="dg-acts">
        <button class="btn" onclick="randDG()">üîÄ RANDOMIZE</button>
        <button class="btn sv" onclick="saveDG()">üíæ SAVE TO TOURNAMENT</button>
        <button class="btn s" onclick="closeDG()">CANCEL</button>
      </div>
      <div id="dgPrev"></div>
    </div>
  </div>
</div>

<!-- PAGES -->
<div class="pg active" id="pg-dash">
  <div class="pg-h"><h1 id="dshT">EFB CUP MANAGER</h1><p>TOURNAMENT CONTROL CENTER</p></div>
  <div class="sr">
    <div class="sc"><div class="sn" id="st-g">4</div><div class="sl">Groups</div></div>
    <div class="sc"><div class="sn" id="st-t">16</div><div class="sl">Teams</div></div>
    <div class="sc"><div class="sn" id="st-m">8</div><div class="sl">Matches</div></div>
    <div class="sc"><div class="sn" id="st-k">QF</div><div class="sl">KO Format</div></div>
  </div>
  <div class="dg2">
    <div class="dc">
      <div class="dct">Quick Navigate</div>
      <div class="qnv">
        <button class="btn"   onclick="go('draw')"  style="width:100%;text-align:left">üéØ Group Draw ‚Üí</button>
        <button class="btn s" onclick="go('fix')"   style="width:100%;text-align:left">‚öΩ Fixtures ‚Üí</button>
        <button class="btn s" onclick="go('pts')"   style="width:100%;text-align:left">üìã Points Table ‚Üí</button>
        <button class="btn s" onclick="go('ko')"    style="width:100%;text-align:left">üèÜ Knockout ‚Üí</button>
        <button class="btn s" onclick="go('notes')" style="width:100%;text-align:left">üìù Notes ‚Üí</button>
        <button class="btn s" onclick="openDG()"    style="width:100%;text-align:left">üé≤ Draw Groups ‚Üí</button>
      </div>
    </div>
    <div class="dc">
      <div class="dct">Tournament Info</div>
      <div class="ir"><span>Name</span><span id="if-n">EFB CUP</span></div>
      <div class="ir"><span>Groups</span><span id="if-g">4</span></div>
      <div class="ir"><span>Teams/Group</span><span id="if-tg">4</span></div>
      <div class="ir"><span>Total Teams</span><span id="if-tt">16</span></div>
      <div class="ir"><span>Matches/Group</span><span id="if-mg">2</span></div>
    </div>
  </div>
  <div class="dc" style="text-align:center;padding:14px">
    <p style="color:var(--muted);font-size:10px;letter-spacing:3px">‚ò∞ MENU ¬∑ ‚öô SETTINGS ¬∑ Q QUALIFY ¬∑ üîÉ SORT POINTS ¬∑ CTRL+S SAVE</p>
  </div>
</div>

<div class="pg" id="pg-draw">
  <div class="cw"><div class="ca" id="ca-draw">
    <div class="ubg" id="bg-draw"></div><div class="ovl"></div>
    <div class="cl">
      <div class="mh" contenteditable="true" id="ti-draw" oninput="aS()">EFB CUP ‚Äî GROUP DRAW</div>
      <div class="gl" id="gr-draw"></div>
    </div>
  </div></div>
  <div class="pctrl">
    <button class="btn s" onclick="document.getElementById('bgf-draw').click()">üìÅ BG</button>
    <input type="file" id="bgf-draw" accept="image/*" hidden onchange="handleBg(this,'draw')">
    <div class="zc"><label>ZOOM</label><input type="range" min="1" max="3" step="0.05" value="1" oninput="bgZm('draw',this.value)"></div>
    <button class="btn sv" onclick="saveAll()">üíæ SAVE</button>
    <button class="btn" onclick="expPg('ca-draw','EFB_Group_Draw')">‚¨á EXPORT</button>
  </div>
</div>

<div class="pg" id="pg-fix">
  <div class="cw"><div class="ca" id="ca-fix">
    <div class="ubg" id="bg-fix"></div><div class="ovl"></div>
    <div class="cl">
      <div class="mh" contenteditable="true" id="ti-fix" oninput="aS()">EFB CUP ‚Äî FIXTURES</div>
      <div class="gl" id="gr-fix"></div>
    </div>
  </div></div>
  <div class="pctrl">
    <button class="btn s" onclick="document.getElementById('bgf-fix').click()">üìÅ BG</button>
    <input type="file" id="bgf-fix" accept="image/*" hidden onchange="handleBg(this,'fix')">
    <div class="zc"><label>ZOOM</label><input type="range" min="1" max="3" step="0.05" value="1" oninput="bgZm('fix',this.value)"></div>
    <button class="btn sv" onclick="saveAll()">üíæ SAVE</button>
    <button class="btn" onclick="expPg('ca-fix','EFB_Fixtures')">‚¨á EXPORT</button>
  </div>
</div>

<div class="pg" id="pg-pts">
  <div class="cw"><div class="ca" id="ca-pts">
    <div class="ubg" id="bg-pts"></div><div class="ovl"></div>
    <div class="cl">
      <div class="mh" contenteditable="true" id="ti-pts" oninput="aS()">EFB CUP ‚Äî POINTS TABLE</div>
      <div class="gl" id="gr-pts"></div>
    </div>
  </div></div>
  <div class="pctrl">
    <button class="btn s" onclick="document.getElementById('bgf-pts').click()">üìÅ BG</button>
    <input type="file" id="bgf-pts" accept="image/*" hidden onchange="handleBg(this,'pts')">
    <div class="zc"><label>ZOOM</label><input type="range" min="1" max="3" step="0.05" value="1" oninput="bgZm('pts',this.value)"></div>
    <button class="btn sort" onclick="sortPts()">üîÉ SORT BY PTS</button>
    <button class="btn sv" onclick="saveAll()">üíæ SAVE</button>
    <button class="btn" onclick="expPg('ca-pts','EFB_Points_Table')">‚¨á EXPORT</button>
  </div>
</div>

<div class="pg" id="pg-ko">
  <div class="rr">
    <button class="btn s" onclick="rstKO()">üîÑ Restore Deleted</button>
    <span style="color:var(--muted);font-size:10px;letter-spacing:2px">DRAG TO SWAP ¬∑ HOVER ‚úï TO DELETE</span>
  </div>
  <div class="cw"><div class="ca" id="ca-ko" style="min-height:820px">
    <div class="ubg" id="bg-ko"></div><div class="ovl"></div>
    <div class="cl">
      <div class="mh" contenteditable="true" id="ti-ko" oninput="aS()">EFB CUP ‚Äî KNOCKOUT</div>
      <div class="bks"><div class="bkf" id="bkf"></div></div>
    </div>
  </div></div>
  <div class="pctrl">
    <button class="btn s" onclick="document.getElementById('bgf-ko').click()">üìÅ BG</button>
    <input type="file" id="bgf-ko" accept="image/*" hidden onchange="handleBg(this,'ko')">
    <div class="zc"><label>ZOOM</label><input type="range" min="1" max="3" step="0.05" value="1" oninput="bgZm('ko',this.value)"></div>
    <button class="btn s" onclick="rstKO()">üîÑ RESTORE</button>
    <button class="btn sv" onclick="saveAll()">üíæ SAVE</button>
    <button class="btn" onclick="expPg('ca-ko','EFB_Knockout')">‚¨á EXPORT</button>
  </div>
</div>

<div class="pg" id="pg-notes">
  <div class="pg-h"><h1>NOTES &amp; SCHEDULE</h1><p>TOURNAMENT HUB</p></div>
  <textarea class="nta" id="nTA" placeholder="Tournament notes, rules, announcements..." oninput="aS()"></textarea>
  <div class="scc">
    <h2>Match Schedule</h2>
    <div id="scL"></div>
    <button class="btn s" style="margin-top:12px" onclick="addSc()">+ ADD MATCH</button>
  </div>
  <div class="pctrl"><button class="btn sv" onclick="saveAll()">üíæ SAVE NOTES</button></div>
</div>
<script>
'use strict';
const GL='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
const S={gc:4,tc:4,mc:2,ko:8,nm:'EFB CUP SEASON 3',th:'cyber',fn:'default',bgs:{},sc:[],cur:'dash',ast:null,tt:null,qN:2,dg:{count:20,gc:4,tc:5,teams:[],result:[]}};

/* ‚ïê‚ïê AUDIO ENGINE ‚ïê‚ïê */
const AX=(()=>{
  let ctx=null,master=null,rdy=false;
  function init(){
    if(rdy)return;
    try{
      ctx=new(window.AudioContext||window.webkitAudioContext)();
      master=ctx.createGain();master.gain.value=0.48;master.connect(ctx.destination);
      if(ctx.state==='suspended')ctx.resume().catch(()=>{});
      rdy=true;
    }catch(e){}
  }
  try{init();}catch(e){}
  document.addEventListener('deviceready',init,false);

  function note(f,dl,dur,vol=0.06,tp='sine',atk=0.012){
    if(!ctx||!rdy)return;
    try{
      const o=ctx.createOscillator(),g=ctx.createGain(),lp=ctx.createBiquadFilter();
      lp.type='lowpass';lp.frequency.value=3600;
      o.connect(lp);lp.connect(g);g.connect(master);
      o.type=tp;o.frequency.value=f;
      const t0=ctx.currentTime+dl;
      g.gain.setValueAtTime(0,t0);g.gain.linearRampToValueAtTime(vol,t0+atk);
      g.gain.setValueAtTime(vol,t0+dur*.55);g.gain.exponentialRampToValueAtTime(0.0001,t0+dur);
      o.start(t0);o.stop(t0+dur+.06);
    }catch(e){}
  }
  function sweep(f0,f1,dl,dur,vol=0.05){
    if(!ctx||!rdy)return;
    try{
      const o=ctx.createOscillator(),g=ctx.createGain(),lp=ctx.createBiquadFilter();
      lp.type='lowpass';lp.frequency.value=2200;o.connect(lp);lp.connect(g);g.connect(master);o.type='sine';
      const t0=ctx.currentTime+dl;
      o.frequency.setValueAtTime(f0,t0);o.frequency.exponentialRampToValueAtTime(f1,t0+dur);
      g.gain.setValueAtTime(0,t0);g.gain.linearRampToValueAtTime(vol,t0+.02);g.gain.exponentialRampToValueAtTime(0.0001,t0+dur);
      o.start(t0);o.stop(t0+dur+.05);
    }catch(e){}
  }
  function boot(){
    if(!rdy)return;
    note(55,0,2,.032,'sine',.5);note(110,0,2,.018,'triangle',.5);
    [196,247,294,370,440,587,740,988].forEach((f,i)=>note(f,.28+i*.24,.4,.038,'triangle',.014));
    note(523,2.2,.9,.052,'sine',.007);note(659,2.38,.78,.052,'sine',.007);
    note(784,2.55,.68,.052,'sine',.007);note(1047,2.72,1.1,.058,'sine',.007);
    note(2093,2.82,.5,.016,'triangle',.01);
  }
  function play(tp){
    if(!rdy)return;
    if(ctx.state==='suspended'){ctx.resume().catch(()=>{});return;}
    if(tp==='nav')   {note(900,0,.07,.034,'sine',.003);note(1200,.04,.06,.019,'sine',.003);}
    if(tp==='save')  {note(659,0,.3,.05,'sine',.007);note(784,.1,.35,.046,'sine',.007);note(1047,.2,.45,.053,'sine',.007);note(1319,.3,.4,.036,'sine',.007);}
    if(tp==='del')   {note(160,0,.12,.062,'sine',.003);note(100,.04,.18,.046,'sine',.003);sweep(180,80,0,.15,.036);}
    if(tp==='swap')  {sweep(250,700,0,.2,.05);note(880,.14,.18,.03,'triangle',.01);}
    if(tp==='exp')   {[523,659,784,1047].forEach((f,i)=>note(f,i*.11,.45-i*.04,.05,'sine',.006));}
    if(tp==='open')  {sweep(300,620,0,.18,.036);note(620,.12,.15,.022,'triangle',.01);}
    if(tp==='close') {sweep(500,280,0,.15,.03);}
    if(tp==='sort')  {sweep(300,900,0,.22,.042);note(900,.16,.25,.036,'sine',.01);}
    if(tp==='theme') {note(880,0,.15,.036,'triangle',.005);note(1320,.06,.18,.027,'triangle',.005);note(1760,.12,.2,.021,'triangle',.005);}
    if(tp==='restore'){sweep(300,950,0,.25,.036);note(1047,.18,.3,.036,'sine',.01);}
    if(tp==='q')     {note(1047,0,.2,.048,'sine',.005);note(1319,.1,.25,.038,'sine',.005);note(1568,.2,.3,.033,'sine',.005);}
    if(tp==='rand')  {[400,500,650,800,1000].forEach((f,i)=>note(f,i*.06,.18,.04,'triangle',.008));}
  }
  return{boot,play,init};
})();

/* ‚ïê‚ïê LOADING ‚ïê‚ïê */
function initLd(){
  const pc=document.getElementById('ldP');
  for(let i=0;i<60;i++){
    const p=document.createElement('div');p.className='ld-pt';
    const sz=1+Math.random()*4;
    p.style.cssText=`left:${Math.random()*100}%;width:${sz}px;height:${sz}px;--d:${2.8+Math.random()*4}s;--dl:${Math.random()*3.5}s;--dx:${(Math.random()-.5)*200}px`;
    pc.appendChild(p);
  }
  const msgs=['LOADING DATA...','RESTORING PROGRESS...','INITIALIZING...','ALMOST READY...','READY ‚úì'];
  let mi=0;const el=document.getElementById('ldSt');
  const iv=setInterval(()=>{mi++;if(mi<msgs.length)el.textContent=msgs[mi];else clearInterval(iv);},660);
  setTimeout(()=>AX.boot(),200);
  setTimeout(()=>{
    clearInterval(iv);
    const ldEl=document.getElementById('ld');
    if(ldEl){ldEl.classList.add('out');setTimeout(()=>ldEl.remove(),900);}
  },3500);
}

/* ‚ïê‚ïê SIDEBAR ‚ïê‚ïê */
function togSB(){
  const open=document.getElementById('sb').classList.toggle('open');
  document.getElementById('hBtn').classList.toggle('open',open);
  document.getElementById('sbo').classList.toggle('on',open);
  if(open){document.getElementById('sp').classList.remove('open');hideQ();AX.play('open');}
  else AX.play('close');
}
function closeSB(){document.getElementById('sb').classList.remove('open');document.getElementById('hBtn').classList.remove('open');document.getElementById('sbo').classList.remove('on');}
function togSP(){const open=document.getElementById('sp').classList.toggle('open');if(open){closeSB();hideQ();}}

/* ‚ïê‚ïê Q PANEL ‚ïê‚ïê */
function togQ(){
  const p=document.getElementById('qPanel');
  if(p.classList.contains('show'))hideQ();
  else{p.classList.add('show');document.getElementById('qBtn').classList.add('on');renderQP();closeSB();document.getElementById('sp').classList.remove('open');}
}
function hideQ(){document.getElementById('qPanel').classList.remove('show');document.getElementById('qBtn').classList.remove('on');}

/* ‚ïê‚ïê MATCH COUNT PANEL ‚ïê‚ïê */
function togMC(){
  const p=document.getElementById('mcPanel');
  if(p.classList.contains('show'))hideMC();
  else{p.classList.add('show');document.getElementById('mcBtn').classList.add('on');renderMCP();closeSB();document.getElementById('sp').classList.remove('open');hideQ();}
}
function hideMC(){document.getElementById('mcPanel').classList.remove('show');document.getElementById('mcBtn').classList.remove('on');}
function renderMCP(){
  const row=document.getElementById('mcNRow');row.innerHTML='';
  [2,3,4].forEach(n=>{
    const b=document.createElement('button');b.className='mcp-n'+(n===S.mc?' on':'');
    b.textContent=n;
    b.onclick=()=>{S.mc=n;document.getElementById('mcBtnVal').textContent=n;const si=document.getElementById('sgM');if(si)si.value=n;renderMCP();bFix();updDash();aS();hideMC();toast(`‚úì ${n} MATCHES PER GROUP`);};
    row.appendChild(b);
  });
}
function renderQP(){
  const row=document.getElementById('qNRow');row.innerHTML='';
  [1,2,3,4].forEach(n=>{
    const b=document.createElement('button');b.className='qp-n'+(n===S.qN?' on':'');
    b.textContent=n;b.onclick=()=>{S.qN=n;renderQP();};row.appendChild(b);
  });
}
function applyQ(){
  AX.play('q');
  const teams=ld('drawT')||{},stats=ld('ptsSt')||{};
  /* Strip old Q */
  Object.keys(teams).forEach(k=>{if(teams[k])teams[k]=teams[k].replace(/\s*\[Q\]/g,'').trim();});
  for(let gi=0;gi<S.gc;gi++){
    const slots=[];
    for(let t=1;t<=S.tc;t++){
      const k=`${gi}_${t}`;const st=stats[k]||{w:0,d:0,l:0,gf:0,ga:0};
      const nm=teams[k]||'';if(!nm)continue;
      slots.push({k,pts:st.w*3+st.d,gd:st.gf-st.ga});
    }
    slots.sort((a,b)=>b.pts-a.pts||b.gd-a.gd);
    for(let i=0;i<Math.min(S.qN,slots.length);i++){
      const k=slots[i].k;if(!teams[k])teams[k]='';
      if(!teams[k].includes('[Q]'))teams[k]=(teams[k]+' [Q]').trim();
    }
  }
  localStorage.setItem('efb_drawT',JSON.stringify(teams));
  bDraw();bPts(true);hideQ();
  toast(`‚úì TOP ${S.qN} PER GROUP MARKED [Q]`);
}
function removeQ(){
  AX.play('del');
  const teams=ld('drawT')||{};
  Object.keys(teams).forEach(k=>{if(teams[k])teams[k]=teams[k].replace(/\s*\[Q\]/g,'').trim();});
  localStorage.setItem('efb_drawT',JSON.stringify(teams));
  bDraw();bPts();hideQ();toast('‚úì ALL Q MARKS REMOVED');
}

/* ‚ïê‚ïê THEME / FONT ‚ïê‚ïê */
function setTh(t){
  document.body.className=document.body.className.replace(/th-\w+/g,'').trim();
  document.body.classList.add('th-'+t);
  document.querySelectorAll('.tc').forEach(b=>b.classList.remove('on'));
  document.getElementById('tc-'+t)?.classList.add('on');
  S.th=t;AX.play('theme');aS();
}
function setFnt(k){
  document.body.className=document.body.className.replace(/fn-\w+/g,'').trim();
  if(k!=='default')document.body.classList.add('fn-'+k);
  document.querySelectorAll('.fc').forEach(b=>b.classList.remove('on'));
  document.getElementById('fc-'+k)?.classList.add('on');
  S.fn=k;AX.play('nav');aS();
}
function updNm(v){
  S.nm=v||'EFB TOURNAMENT';
  document.getElementById('dshT').textContent=S.nm;
  document.getElementById('sbNm').textContent=S.nm;
  document.getElementById('if-n').textContent=S.nm;
  aS();
}
function applyS(){
  S.gc=+document.getElementById('sgG').value;
  S.tc=+document.getElementById('sgT').value;
  S.mc=+document.getElementById('sgM').value;
  S.ko=+document.getElementById('sgK').value;
  document.getElementById('mcBtnVal').textContent=S.mc;
  bDraw();bFix();bPts();bKO();updDash();aS();
}

/* ‚ïê‚ïê PAGE SWITCH ‚ïê‚ïê */
function go(page){
  if(S.cur===page){closeSB();return;}
  AX.play('nav');
  const old=document.getElementById('pg-'+S.cur);
  old.style.cssText='transition:opacity .2s,transform .2s;opacity:0;transform:translateY(-8px);display:block;';
  setTimeout(()=>{
    old.classList.remove('active');old.style.cssText='';
    const nxt=document.getElementById('pg-'+page);
    nxt.classList.add('active');nxt.style.cssText='opacity:0;transform:translateY(10px);transition:opacity .28s,transform .28s;';
    requestAnimationFrame(()=>requestAnimationFrame(()=>{nxt.style.opacity='1';nxt.style.transform='translateY(0)';setTimeout(()=>{nxt.style.cssText='';},280);}));
  },200);
  document.querySelectorAll('.ni').forEach(n=>n.classList.remove('active'));
  document.querySelector(`[data-page="${page}"]`)?.classList.add('active');
  S.cur=page;closeSB();document.getElementById('sp').classList.remove('open');hideQ();
}

/* ‚ïê‚ïê BACKGROUNDS ‚ïê‚ïê */
function handleBg(inp,pid){
  if(!inp.files[0])return;
  const r=new FileReader();
  r.onload=e=>{S.bgs[pid]=e.target.result;document.getElementById('bg-'+pid).style.backgroundImage=`url(${e.target.result})`;aS();};
  r.readAsDataURL(inp.files[0]);
}
function bgZm(pid,v){document.getElementById('bg-'+pid).style.transform=`scale(${v})`;}

/* ‚ïê‚ïê BUILD: GROUP DRAW ‚Äî team name input auto-syncs to points table ‚ïê‚ïê */
function bDraw(){
  const con=document.getElementById('gr-draw');con.innerHTML='';
  const teams=ld('drawT')||{},gns=ld('drawGN')||{};
  for(let i=0;i<S.gc;i++){
    let rows='';
    for(let t=1;t<=S.tc;t++){
      const k=`${i}_${t}`;
      rows+=`<tr><td class="rk">${t}</td>
        <td class="tl tnm" contenteditable="true" data-ph="TEAM ${t}" data-k="${k}"
            oninput="svDraw('${k}',this)">${esc(teams[k]||'')}</td></tr>`;
    }
    con.innerHTML+=`<div class="gc">
      <div class="gct"><span class="gci">‚öΩ</span>
        <div class="gcn" contenteditable="true" oninput="svGN('drawGN',${i},this)">${esc(gns[i]||`GROUP ${GL[i]}`)}</div>
      </div>
      <table><thead><tr><th>#</th><th class="tl">Club</th></tr></thead><tbody>${rows}</tbody></table>
    </div>`;
  }
}

/* Save draw team name AND live-update matching pts table cell */
function svDraw(k,el){
  const teams=ld('drawT')||{};
  teams[k]=el.textContent.trim();
  localStorage.setItem('efb_drawT',JSON.stringify(teams));
  /* Live update pts table without full rebuild */
  const ptCell=document.querySelector(`#gr-pts tr[data-key="${k}"] td.tnm`);
  if(ptCell&&document.activeElement!==ptCell)ptCell.textContent=teams[k];
  aS();
}

/* ‚ïê‚ïê BUILD: FIXTURES ‚ïê‚ïê */
function bFix(){
  const con=document.getElementById('gr-fix');con.innerHTML='';
  const fd=ld('fixD')||{},gns=ld('fixGN')||{};
  for(let g=0;g<S.gc;g++){
    let rows='';
    for(let m=1;m<=S.mc;m++){
      const hk=`${g}_${m}_h`,ak=`${g}_${m}_a`,mk=`${g}_${m}_m`;
      rows+=`<div class="fr"><div class="frb"></div>
        <div class="frt h" contenteditable="true" data-ph="HOME TEAM" oninput="svFx('${hk}',this)">${esc(fd[hk]||'')}</div>
        <div class="fvw"><div class="fvp">VS</div></div>
        <div class="frt" contenteditable="true" data-ph="AWAY TEAM" oninput="svFx('${ak}',this)">${esc(fd[ak]||'')}</div>
        <div class="fm" contenteditable="true" data-ph="Date ¬∑ Time ¬∑ Venue" oninput="svFx('${mk}',this)">${esc(fd[mk]||'')}</div>
      </div>`;
    }
    const gname=esc(ld('fixGN')?.[g]||ld('drawGN')?.[g]||`GROUP ${GL[g]}`);
    con.innerHTML+=`<div class="gc"><div class="gct"><span class="gci">üìÖ</span>
      <div class="gcn" contenteditable="true" oninput="svGN('fixGN',${g},this)">${gname}</div>
    </div>${rows}</div>`;
  }
}

/* ‚ïê‚ïê BUILD: POINTS TABLE ‚Äî pulls team names from drawT automatically ‚ïê‚ïê */
function bPts(sorted){
  const con=document.getElementById('gr-pts');con.innerHTML='';
  const teams=ld('drawT')||{},stats=ld('ptsSt')||{},gns=ld('drawGN')||{};
  for(let i=0;i<S.gc;i++){
    /* Build row data */
    let rowData=[];
    for(let t=1;t<=S.tc;t++){
      const k=`${i}_${t}`;
      const st=stats[k]||{w:0,d:0,l:0,gf:0,ga:0};
      const p=st.w+st.d+st.l,gd=st.gf-st.ga,pts=st.w*3+st.d;
      rowData.push({k,tn:teams[k]||'',t,p,w:st.w,d:st.d,l:st.l,gf:st.gf,ga:st.ga,gd,pts});
    }
    /* Sort only when explicitly requested */
    if(sorted)rowData.sort((a,b)=>b.pts-a.pts||b.gd-a.gd||b.gf-a.gf);
    let rows='';
    rowData.forEach((r,idx)=>{
      const rank=sorted?idx+1:r.t;
      const gdStr=r.gd>0?'+'+r.gd:r.gd;
      rows+=`<tr data-key="${r.k}">
        <td class="rk">${rank}</td>
        <td class="tl tnm" contenteditable="true" data-ph="TEAM ${r.t}"
            oninput="syncTN('${r.k}',this)">${esc(r.tn)}</td>
        <td class="cp">${r.p}</td>
        <td><input class="si" type="number" min="0" value="${r.w}"  data-st="w"  data-k="${r.k}" oninput="onSt(this)"></td>
        <td><input class="si" type="number" min="0" value="${r.d}"  data-st="d"  data-k="${r.k}" oninput="onSt(this)"></td>
        <td><input class="si" type="number" min="0" value="${r.l}"  data-st="l"  data-k="${r.k}" oninput="onSt(this)"></td>
        <td><input class="si" type="number" min="0" value="${r.gf}" data-st="gf" data-k="${r.k}" oninput="onSt(this)"></td>
        <td><input class="si" type="number" min="0" value="${r.ga}" data-st="ga" data-k="${r.k}" oninput="onSt(this)"></td>
        <td class="cgd">${gdStr}</td>
        <td class="pts cpts">${r.pts}</td>
      </tr>`;
    });
    const gname=esc(gns[i]||`GROUP ${GL[i]}`);
    con.innerHTML+=`<div class="gc"><div class="gct"><span class="gci">üìã</span>${gname}</div>
      <table><thead><tr><th>#</th><th class="tl">Club</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>PTS</th></tr></thead>
      <tbody>${rows}</tbody></table>
    </div>`;
  }
}

/* Sort button handler */
function sortPts(){
  AX.play('sort');bPts(true);toast('‚úì SORTED BY POINTS & GD');
}

/* Sync pts table name edit back to drawT */
function syncTN(k,el){
  const teams=ld('drawT')||{};
  teams[k]=el.textContent.trim();
  localStorage.setItem('efb_drawT',JSON.stringify(teams));
  /* Update draw grid live if visible */
  const dc=document.querySelector(`#gr-draw [data-k="${k}"]`);
  if(dc&&document.activeElement!==dc)dc.textContent=teams[k];
  aS();
}

/* Stat input recalculate */
function onSt(inp){
  const k=inp.dataset.k,stats=ld('ptsSt')||{};
  if(!stats[k])stats[k]={w:0,d:0,l:0,gf:0,ga:0};
  stats[k][inp.dataset.st]=Math.max(0,parseInt(inp.value)||0);
  localStorage.setItem('efb_ptsSt',JSON.stringify(stats));
  const st=stats[k],p=st.w+st.d+st.l,gd=st.gf-st.ga,pts=st.w*3+st.d;
  const row=document.querySelector(`tr[data-key="${k}"]`);
  if(!row)return;
  row.querySelector('.cp').textContent=p;
  row.querySelector('.cgd').textContent=gd>0?'+'+gd:gd;
  row.querySelector('.cpts').textContent=pts;
  clearTimeout(S.ast);S.ast=setTimeout(saveAll,2200);
}

/* ‚ïê‚ïê BUILD: KNOCKOUT ‚ïê‚ïê */
function bKO(){
  const con=document.getElementById('bkf');con.innerHTML='';
  const kd=ld('koD')||{},del=ld('koDel')||{};
  let rds=[];
  if(S.ko>=16)rds=[{l:'ROUND OF 16',n:8},{l:'QUARTER FINALS',n:4},{l:'SEMI FINALS',n:2},{l:'FINAL',n:1}];
  else if(S.ko===8)rds=[{l:'QUARTER FINALS',n:4},{l:'SEMI FINALS',n:2},{l:'FINAL',n:1}];
  else rds=[{l:'SEMI FINALS',n:2},{l:'FINAL',n:1}];

  rds.forEach((rnd,ri)=>{
    const col=document.createElement('div');col.className='bkc';
    const head=document.createElement('div');head.className='bkch';
    head.innerHTML=`<div class="bkrl">${rnd.l}</div>
      <button class="bkrd" onclick="delRnd('${rnd.l}')" title="Delete round">‚úï</button>`;
    col.appendChild(head);
    const wrap=document.createElement('div');wrap.className='bkms';
    wrap.style.gap=`${20+ri*88}px`;
    for(let m=0;m<rnd.n;m++){
      const mk=`${rnd.l}_${m}`;
      if(del[mk])continue;
      const k1=mk+'_1',k2=mk+'_2',sc1=mk+'_sc1',sc2=mk+'_sc2';
      const match=document.createElement('div');match.className='bkm';match.id='bkm-'+mk;
      match.innerHTML=`
        <button class="bkdel" onclick="delMt('${mk}')">‚úï</button>
        <div class="bks2" draggable="true" ondragstart="kdS(event,'${k1}')" ondragover="kdO(event)" ondragleave="kdL(event)" ondrop="kdD(event,'${k1}')">
          <span class="bksn">${m*2+1}</span>
          <span class="bksname" contenteditable="true" oninput="svKO('${k1}',this)">${esc(kd[k1]||'')}</span>
          <input class="bksc" type="number" min="0" value="${kd[sc1]||''}" placeholder="‚Äì" oninput="svKO('${sc1}',this,'v')">
        </div>
        <div class="bks2" draggable="true" ondragstart="kdS(event,'${k2}')" ondragover="kdO(event)" ondragleave="kdL(event)" ondrop="kdD(event,'${k2}')">
          <span class="bksn">${m*2+2}</span>
          <span class="bksname" contenteditable="true" oninput="svKO('${k2}',this)">${esc(kd[k2]||'')}</span>
          <input class="bksc" type="number" min="0" value="${kd[sc2]||''}" placeholder="‚Äì" oninput="svKO('${sc2}',this,'v')">
        </div>`;
      wrap.appendChild(match);
    }
    col.appendChild(wrap);con.appendChild(col);
    if(ri<rds.length-1){
      const cn=document.createElement('div');cn.className='bkcon';cn.innerHTML='<span>‚Üí</span>';con.appendChild(cn);
    }
  });
  /* Winner box */
  const wc=document.createElement('div');wc.className='bkc wcol';
  wc.innerHTML=`<div class="bkrl" style="margin-bottom:14px">CHAMPION</div>
    <div class="wbox" ondragover="kdO(event)" ondragleave="kdL(event)" ondrop="kdD(event,'WIN')">
      <span class="wtr">üèÜ</span>
      <div class="wlbl">TOURNAMENT WINNER</div>
      <div class="wnm" contenteditable="true" oninput="svKO('WIN',this)">${esc(kd['WIN']||'???')}</div>
    </div>`;
  con.appendChild(wc);
}
function delMt(mk){
  AX.play('del');
  const del=ld('koDel')||{};del[mk]=true;localStorage.setItem('efb_koDel',JSON.stringify(del));
  const el=document.getElementById('bkm-'+mk);if(el)el.classList.add('gone');
  toast('BOX DELETED ¬∑ RESTORE TO UNDO');
}
function delRnd(lbl){
  if(!confirm(`Delete all "${lbl}" boxes?`))return;
  AX.play('del');
  const del=ld('koDel')||{};
  document.querySelectorAll(`[id^="bkm-${lbl}_"]`).forEach(el=>{del[el.id.replace('bkm-','')]=true;el.classList.add('gone');});
  localStorage.setItem('efb_koDel',JSON.stringify(del));
  toast(`${lbl} DELETED`);
}
function rstKO(){AX.play('restore');localStorage.removeItem('efb_koDel');bKO();toast('‚úì ALL BOXES RESTORED');}
let _dk=null;
function kdS(e,k){_dk=k;e.dataTransfer.effectAllowed='move';setTimeout(()=>e.target.closest('.bks2')?.classList.add('drag'),0);}
function kdO(e){e.preventDefault();e.target.closest('.bks2,.wbox')?.classList.add('over');}
function kdL(e){e.target.closest('.bks2,.wbox')?.classList.remove('over');}
function kdD(e,tk){
  e.preventDefault();document.querySelectorAll('.bks2,.wbox').forEach(s=>s.classList.remove('drag','over'));
  if(!_dk||_dk===tk)return;AX.play('swap');
  const kd=ld('koD')||{};const tmp=kd[_dk];kd[_dk]=kd[tk];kd[tk]=tmp;
  localStorage.setItem('efb_koD',JSON.stringify(kd));bKO();toast('‚úì SWAPPED');
}
function svKO(k,el,mode){
  const kd=ld('koD')||{};kd[k]=(mode==='v')?el.value:el.textContent.trim();
  localStorage.setItem('efb_koD',JSON.stringify(kd));aS();
}

/* ‚ïê‚ïê SAVE / LOAD / CLEAR ‚ïê‚ïê */
function ld(k){try{return JSON.parse(localStorage.getItem('efb_'+k));}catch{return null;}}
function saveAll(){
  AX.play('save');
  ['draw','fix','pts','ko'].forEach(pg=>{const el=document.getElementById('ti-'+pg);if(el)localStorage.setItem('efb_ti_'+pg,el.textContent);});
  localStorage.setItem('efb_notes',document.getElementById('nTA')?.value||'');
  localStorage.setItem('efb_sc',JSON.stringify(S.sc));
  localStorage.setItem('efb_bgs',JSON.stringify(S.bgs));
  localStorage.setItem('efb_cfg',JSON.stringify({gc:S.gc,tc:S.tc,mc:S.mc,ko:S.ko,nm:S.nm,th:S.th,fn:S.fn,qN:S.qN}));
  toast('‚úì ALL PROGRESS SAVED');
}
function aS(){clearTimeout(S.ast);S.ast=setTimeout(saveAll,2200);}
function loadAll(){
  const cfg=ld('cfg');
  if(cfg){
    S.gc=cfg.gc||4;S.tc=cfg.tc||4;S.mc=cfg.mc||2;S.ko=cfg.ko||8;
    S.nm=cfg.nm||'EFB CUP SEASON 3';S.th=cfg.th||'cyber';S.fn=cfg.fn||'default';S.qN=cfg.qN||2;
    document.getElementById('sgG').value=S.gc;document.getElementById('sgT').value=S.tc;
    document.getElementById('sgM').value=S.mc;document.getElementById('sgK').value=S.ko;
    document.getElementById('sgN').value=S.nm;
    setTh(S.th);setFnt(S.fn);updNm(S.nm);
  }
  const bgs=ld('bgs')||{};S.bgs=bgs;
  Object.entries(bgs).forEach(([pid,url])=>{const el=document.getElementById('bg-'+pid);if(el)el.style.backgroundImage=`url(${url})`;});
  const notes=localStorage.getItem('efb_notes');if(notes)document.getElementById('nTA').value=notes;
  ['draw','fix','pts','ko'].forEach(pg=>{const v=localStorage.getItem('efb_ti_'+pg);const el=document.getElementById('ti-'+pg);if(v&&el)el.textContent=v;});
  const sc=ld('sc');if(sc)S.sc=sc;renderSc();
}
function clrAll(){if(!confirm('Clear ALL data? Cannot be undone!'))return;AX.play('del');localStorage.clear();location.reload();}

/* ‚ïê‚ïê DASHBOARD ‚ïê‚ïê */
function updDash(){
  const tt=S.gc*S.tc,koL={4:'SF',8:'QF',16:'R16'}[S.ko]||'KO';
  document.getElementById('st-g').textContent=S.gc;document.getElementById('st-t').textContent=tt;
  document.getElementById('st-m').textContent=S.gc*S.mc;document.getElementById('st-k').textContent=koL;
  document.getElementById('if-g').textContent=S.gc;document.getElementById('if-tg').textContent=S.tc;
  document.getElementById('if-tt').textContent=tt;document.getElementById('if-mg').textContent=S.mc;
}

/* ‚ïê‚ïê EXPORT ‚Äî Now works on Android APK ‚ïê‚ïê */
function expPg(cId, fname) {
  AX.play('exp');
  toast('‚è≥ GENERATING IMAGE...');
  const el = document.getElementById(cId);

  html2canvas(el, {
    scale: 2,
    useCORS: true,
    backgroundColor: '#06060e',
    allowTaint: true
  }).then(canvas => {
    const dataUrl = canvas.toDataURL('image/png');
    
    // Check if we are running as an installed App
    if (window.cordova) {
      const b64 = dataUrl.split(',')[1];
      const filename = fname + "_" + Date.now() + ".png";
      
      // We target the 'Pictures' folder so it shows up in your Gallery
      window.resolveLocalFileSystemURL(cordova.file.externalRootDirectory, (dir) => {
        dir.getDirectory("Pictures", { create: true }, (pixDir) => {
          pixDir.getFile(filename, { create: true }, (fileEntry) => {
            fileEntry.createWriter((fileWriter) => {
              fileWriter.onwriteend = () => {
                toast('‚úÖ SAVED TO GALLERY/PICTURES');
              };
              fileWriter.onerror = (e) => {
                console.error("Write failed", e);
                toast('Export failed', 'err');
              };
              const blob = b64toBlob(b64, 'image/png');
              fileWriter.write(blob);
            });
          });
        });
      }, (err) => {
        console.error("FileSystem Error", err);
        // If the fancy save fails, try the basic one
        fallbackDownload(dataUrl, fname);
      });
    } else {
      fallbackDownload(dataUrl, fname);
    }
  }).catch(e => {
    console.error(e);
    toast('Export failed ‚Äî try again', 'err');
  });
}

// Helper to convert the image data for Android storage
function b64toBlob(b64Data, contentType) {
  const byteCharacters = atob(b64Data);
  const byteArrays = [];
  for (let offset = 0; offset < byteCharacters.length; offset += 512) {
    const slice = byteCharacters.slice(offset, offset + 512);
    const byteNumbers = new Array(slice.length);
    for (let i = 0; i < slice.length; i++) {
      byteNumbers[i] = slice.charCodeAt(i);
    }
    const byteArray = new Uint8Array(byteNumbers);
    byteArrays.push(byteArray);
  }
  return new Blob(byteArrays, { type: contentType });
}

function fallbackDownload(dataUrl, fname) {
  const link = document.createElement('a');
  link.href = dataUrl;
  link.download = fname + '.png';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  toast('‚úì IMAGE EXPORTED: ' + fname + '.png');
}
  
      /* Try Cordova file system first, then browser download */
      const dataUrl=canvas.toDataURL('image/png');
      if(window.cordova&&window.resolveLocalFileSystemURL){
        const b64=dataUrl.split(',')[1];
        const folder=cordova.file.externalRootDirectory||cordova.file.documentsDirectory;
        window.resolveLocalFileSystemURL(folder,dir=>{
          dir.getFile(fname+'.png',{create:true},fileEntry=>{
            fileEntry.createWriter(fw=>{
              fw.onwriteend=()=>toast('‚úì SAVED TO DEVICE: '+fname+'.png');
              fw.onerror=()=>fallbackDownload(dataUrl,fname);
              const ab=Uint8Array.from(atob(b64),c=>c.charCodeAt(0));
              fw.write(new Blob([ab],{type:'image/png'}));
            });
          },()=>fallbackDownload(dataUrl,fname));
        },()=>fallbackDownload(dataUrl,fname));
      } else {
        fallbackDownload(dataUrl,fname);
      }
    }).catch(e=>{console.error(e);toast('Export failed ‚Äî try again','err');});
}
function fallbackDownload(dataUrl,fname){
  /* FIX (Issue 2): Convert data URL to Blob then use createObjectURL.
     Raw data: URLs on Android are silently blocked by <a download>.
     Blob + createObjectURL is the Android-reliable method. */
  try{
    const parts=dataUrl.split(',');
    const byteStr=atob(parts[1]);
    const ab=new Uint8Array(byteStr.length);
    for(let i=0;i<byteStr.length;i++)ab[i]=byteStr.charCodeAt(i);
    const blob=new Blob([ab],{type:'image/png'});
    const blobUrl=URL.createObjectURL(blob);
    const a=document.createElement('a');a.download=fname+'.png';a.href=blobUrl;
    document.body.appendChild(a);a.click();document.body.removeChild(a);
    setTimeout(()=>URL.revokeObjectURL(blobUrl),2000);
    toast('‚úì IMAGE EXPORTED: '+fname+'.png');
  }catch(e){console.error(e);toast('Export failed ‚Äî try again','err');}
}
function expCur(){
  const m={draw:['ca-draw','EFB_Group_Draw'],fix:['ca-fix','EFB_Fixtures'],pts:['ca-pts','EFB_Points_Table'],ko:['ca-ko','EFB_Knockout']};
  const e=m[S.cur];if(e)expPg(e[0],e[1]);else toast('Navigate to a canvas page first','err');
}

/* ‚ïê‚ïê HELPER SAVERS ‚ïê‚ïê */
function svGN(stk,i,el){const d=ld(stk)||{};d[i]=el.textContent.trim();localStorage.setItem('efb_'+stk,JSON.stringify(d));aS();}
function svFx(k,el){const d=ld('fixD')||{};d[k]=el.textContent.trim();localStorage.setItem('efb_fixD',JSON.stringify(d));aS();}

/* ‚ïê‚ïê SCHEDULE ‚ïê‚ïê */
function addSc(){S.sc.push({match:'',date:'',time:'',venue:''});renderSc();aS();}
function rmSc(i){S.sc.splice(i,1);renderSc();aS();AX.play('del');}
function updSc(i,f,v){S.sc[i][f]=v;aS();}
function renderSc(){
  const con=document.getElementById('scL');if(!con)return;con.innerHTML='';
  S.sc.forEach((e,i)=>{
    const row=document.createElement('div');row.className='scr';
    row.innerHTML=`<input class="sci" placeholder="Match e.g. A1 vs B2" value="${e2(e.match)}" oninput="updSc(${i},'match',this.value)">
      <input class="sci" type="date" value="${e2(e.date)}" oninput="updSc(${i},'date',this.value)">
      <input class="sci" type="time" value="${e2(e.time)}" oninput="updSc(${i},'time',this.value)">
      <input class="sci" placeholder="Venue" value="${e2(e.venue)}" oninput="updSc(${i},'venue',this.value)">
      <button class="dbt" onclick="rmSc(${i})">‚úï</button>`;
    con.appendChild(row);
  });
}

/* ‚ïê‚ïê DRAW GROUPS MODAL ‚ïê‚ïê */
function openDG(){
  closeSB();document.getElementById('sp').classList.remove('open');
  document.getElementById('dgModal').classList.add('open');
  setDGC(S.dg.count||20);AX.play('open');
}
function closeDG(){document.getElementById('dgModal').classList.remove('open');AX.play('close');}

/* All valid formats per count */
const DG_FORMATS={
  20:[{gc:4,tc:5},{gc:5,tc:4},{gc:2,tc:10}],
  24:[{gc:4,tc:6},{gc:6,tc:4},{gc:3,tc:8},{gc:8,tc:3}]
};

function setDGC(n){
  S.dg.count=n;
  document.getElementById('dgB20').classList.toggle('on',n===20);
  document.getElementById('dgB24').classList.toggle('on',n===24);
  /* Default first format */
  const fmts=DG_FORMATS[n]||[];
  if(fmts.length){S.dg.gc=fmts[0].gc;S.dg.tc=fmts[0].tc;}
  renderDGFormats();buildDGInputs();
}

function renderDGFormats(){
  const fmts=DG_FORMATS[S.dg.count]||[];
  const row=document.getElementById('dgFR');row.innerHTML='';
  fmts.forEach(f=>{
    const b=document.createElement('button');
    b.className='dg-fmt-btn'+(f.gc===S.dg.gc&&f.tc===S.dg.tc?' on':'');
    b.textContent=`${f.gc} GROUPS √ó ${f.tc} TEAMS`;
    b.onclick=()=>{S.dg.gc=f.gc;S.dg.tc=f.tc;renderDGFormats();buildDGInputs();};
    row.appendChild(b);
  });
  document.getElementById('dgInfo').textContent=`${S.dg.gc} GROUPS √ó ${S.dg.tc} TEAMS`;
}

function buildDGInputs(){
  const grid=document.getElementById('dgTG');grid.innerHTML='';
  /* Preserve existing values */
  const existing=S.dg.teams||[];
  for(let i=0;i<S.dg.count;i++){
    const inp=document.createElement('input');
    inp.type='text';inp.className='dg-tin';
    inp.placeholder=`Team ${i+1}`;inp.value=existing[i]||'';
    inp.oninput=()=>{S.dg.teams[i]=inp.value;};
    grid.appendChild(inp);
  }
  if(!S.dg.teams||S.dg.teams.length!==S.dg.count)S.dg.teams=Array(S.dg.count).fill('');
  document.getElementById('dgPrev').innerHTML='';
}

function randDG(){
  AX.play('rand');
  /* Collect names, fill blanks with generic */
  const inputs=document.querySelectorAll('#dgTG .dg-tin');
  let names=Array.from(inputs).map((inp,i)=>inp.value.trim()||`Team ${i+1}`);
  /* Fisher-Yates shuffle */
  for(let i=names.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[names[i],names[j]]=[names[j],names[i]];}
  /* Split into groups */
  S.dg.result=[];
  for(let g=0;g<S.dg.gc;g++){S.dg.result.push({label:`GROUP ${GL[g]}`,teams:names.slice(g*S.dg.tc,(g+1)*S.dg.tc)});}
  /* Preview */
  const prev=document.getElementById('dgPrev');
  let html=`<div class="dg-prev-t" style="margin-top:16px">PREVIEW ‚Äî RANDOMIZED GROUPS</div><div class="dg-ggrid">`;
  S.dg.result.forEach(g=>{
    html+=`<div class="dg-grp"><div class="dg-grp-hd">${g.label}</div>`;
    g.teams.forEach(t=>{html+=`<div class="dg-grp-t">${esc(t)}</div>`;});
    html+=`</div>`;
  });
  html+=`</div>`;
  prev.innerHTML=html;
  toast('‚úì GROUPS RANDOMIZED ‚Äî CHECK PREVIEW BELOW');
}

function saveDG(){
  if(!S.dg.result||!S.dg.result.length){toast('Randomize first!','err');return;}
  AX.play('save');
  /* Update settings to match draw */
  S.gc=S.dg.gc;S.tc=S.dg.tc;
  document.getElementById('sgG').value=S.gc;document.getElementById('sgT').value=S.tc;
  /* Write team names into drawT and drawGN */
  const teams=ld('drawT')||{},gns=ld('drawGN')||{};
  S.dg.result.forEach((grp,gi)=>{
    gns[gi]=grp.label;
    grp.teams.forEach((nm,ti)=>{teams[`${gi}_${ti+1}`]=nm;});
  });
  localStorage.setItem('efb_drawT',JSON.stringify(teams));
  localStorage.setItem('efb_drawGN',JSON.stringify(gns));
  /* Also clear old pts stats so fresh start */
  localStorage.removeItem('efb_ptsSt');
  bDraw();bFix();bPts();updDash();saveAll();
  closeDG();toast('‚úì GROUPS SAVED TO TOURNAMENT');
}

/* ‚ïê‚ïê TOAST ‚ïê‚ïê */
function toast(msg,type){
  const t=document.getElementById('toast');
  t.textContent=msg;t.className=(type==='err'?'err ':'')+' on';
  clearTimeout(S.tt);S.tt=setTimeout(()=>{t.className='';},2800);
}

/* ‚ïê‚ïê HELPERS ‚ïê‚ïê */
function esc(s){return s?String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'):''}
function e2(s){return s?String(s).replace(/"/g,'&quot;'):''}

/* ‚ïê‚ïê KEYBOARD ‚ïê‚ïê */
document.addEventListener('keydown',e=>{
  if((e.ctrlKey||e.metaKey)&&e.key==='s'){e.preventDefault();saveAll();}
  if(e.key==='Escape'){closeSB();document.getElementById('sp').classList.remove('open');hideQ();hideMC();closeDG();}
});

/* ‚ïê‚ïê CLOSE Q PANEL on outside click ‚ïê‚ïê */
document.addEventListener('pointerdown',e=>{
  const qp=document.getElementById('qPanel'),qb=document.getElementById('qBtn');
  if(!qp.contains(e.target)&&!qb.contains(e.target))hideQ();
  const mp=document.getElementById('mcPanel'),mb=document.getElementById('mcBtn');
  if(!mp.contains(e.target)&&!mb.contains(e.target))hideMC();
});

/* ‚ïê‚ïê INIT ‚ïê‚ïê */
window.onload=function(){
  initLd();
  setTimeout(()=>{
    loadAll();bDraw();bFix();bPts();bKO();updDash();
    document.getElementById('mcBtnVal').textContent=S.mc;
    /* Fade-in dashboard */
    const pg=document.getElementById('pg-dash');
    pg.style.cssText='opacity:0;transform:translateY(12px);transition:opacity .5s,transform .5s;';
    requestAnimationFrame(()=>requestAnimationFrame(()=>{
      pg.style.opacity='1';pg.style.transform='translateY(0)';
      setTimeout(()=>{pg.style.cssText='';},500);
    }));
  },200);
};
</script>
</body>
</html>
